// Prisma Schema — Painel SaaS IARA
// UNIFICADO: banco iara_production, tabela "users"
// Mesmo banco que o N8N usa

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// Clínica (tabela unificada: users)
// ============================================

model Clinica {
  id                   Int       @id @default(autoincrement())
  uuid                 String    @db.VarChar(100)
  nome                 String    @db.VarChar(255)
  email                String    @unique @db.VarChar(255)
  telefone             String?   @db.VarChar(20)
  senha                String?
  role                 String?   @default("cliente")
  
  // Plano e créditos
  plano                String    @db.VarChar(100)
  nivel                Int       @default(1)
  status               String?   @default("pendente_configuracao") @db.VarChar(50)
  creditosMensais      Int?      @default(1000) @map("creditos_mensais")
  creditosDisponiveis  Int?      @default(1000) @map("creditos_disponiveis")
  totalAtendimentos    Int?      @default(0) @map("total_atendimentos")
  
  // Clínica
  nomeClinica          String?   @map("nome_clinica") @db.VarChar(255)
  endereco             String?
  
  // Assistente
  nomeAssistente       String?   @default("IARA") @map("nome_assistente") @db.VarChar(100)
  personalidadeVoz     String?   @default("amigavel") @map("personalidade_voz") @db.VarChar(50)
  vozAssistente        String?   @default("nova") @map("voz_assistente") @db.VarChar(20)
  tomAtendimento       String?   @default("Amigável e carismático") @map("tom_atendimento") @db.VarChar(50)
  scriptPersonalizado  String?   @map("script_personalizado")
  
  // Horários
  horarioSegSexInicio  DateTime? @map("horario_seg_sex_inicio") @db.Time()
  horarioSegSexFim     DateTime? @map("horario_seg_sex_fim") @db.Time()
  horarioSabInicio     DateTime? @map("horario_sab_inicio") @db.Time()
  horarioSabFim        DateTime? @map("horario_sab_fim") @db.Time()
  atendeSab            Boolean?  @default(true) @map("atende_sab")
  horarioDomInicio     DateTime? @map("horario_dom_inicio") @db.Time()
  horarioDomFim        DateTime? @map("horario_dom_fim") @db.Time()
  atendeDom            Boolean?  @default(false) @map("atende_dom")
  intervaloAtendimento Int?      @default(15) @map("intervalo_atendimento")
  
  // Descontos
  aceitaDescontos      Boolean?  @default(true) @map("aceita_descontos")
  descontoMaximo       Int?      @default(10) @map("desconto_maximo")
  
  // WhatsApp / Evolution
  evolutionInstance    String?   @map("evolution_instance") @db.VarChar(100)
  whatsappClinica      String?   @map("whatsapp_clinica") @db.VarChar(20)
  whatsappDoutora      String?   @map("whatsapp_doutora")
  evolutionApikey      String?   @map("evolution_apikey")
  qrCode               String?   @map("qr_code")
  qrExpiraEm           DateTime? @map("qr_expira_em")
  
  // Onboarding
  tokenAtivacao        String    @map("token_ativacao") @db.VarChar(255)
  onboardingEtapa      Int?      @default(0) @map("onboarding_etapa")
  onboardingCompleto   Boolean?  @default(false) @map("onboarding_completo")
  
  // Integrações
  googleCalendarToken  String?   @map("google_calendar_token")
  instagramToken       String?   @map("instagram_token")
  instagramsConectados String[]  @map("instagrams_conectados")
  
  // Mídia
  avatarFotos          String[]  @map("avatar_fotos")
  avatarVideo          String?   @map("avatar_video")
  paletaCores          String?   @map("paleta_cores")
  vozClonada           String?   @map("voz_clonada")
  
  // Datas
  dataCompra           DateTime? @default(now()) @map("data_compra")
  dataAtivacao         DateTime? @map("data_ativacao")
  proximaRenovacao     DateTime? @map("proxima_renovacao")
  createdAt            DateTime  @default(now()) @map("created_at")
  updatedAt            DateTime  @default(now()) @map("updated_at")
  
  // JSON configs
  configuracoes        Json?     @default("{}") @db.JsonB
  integracoes          Json?     @default("{}") @db.JsonB
  
  @@map("users")
}
